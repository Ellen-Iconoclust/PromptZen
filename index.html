<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PromptZen — Discover & Share Viral AI Prompts</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6efe9;
      --card:#ffffff;
      --muted:#7a7a8c;
      --accent:#FF7B65; /* coral */
      --accent-2:#ffd9c8;
      --hover-purple:#A46BF5; /* your purple */
      --glass: rgba(255,255,255,0.7);
      --radius:14px;
      --shadow: 0 10px 30px rgba(20,20,30,0.06);
      --max-w:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(circle at 20% 20%, rgba(255,235,230,0.6), transparent 10%),
                  radial-gradient(circle at 80% 70%, rgba(240,235,255,0.4), transparent 12%),
                  var(--bg);
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-bottom:60px;
    }

    /* top glass nav container (contained, not browser) */
    .topbar-wrap{
      position:sticky; top:0; z-index:999;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      border-bottom:1px solid rgba(0,0,0,0.03);
      box-shadow: 0 6px 18px rgba(10,10,12,0.03);
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      max-width:var(--max-w);
      margin:0 auto;
      padding:14px 20px;
    }
    .logo{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo .mark{
      width:44px;height:44px;border-radius:10px;
      display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
      box-shadow: var(--shadow); background: radial-gradient(circle at 30% 30%, #ffd6c6, #ff8b6b);
    }
    .logo .mark svg{width:22px;height:22px;fill:white}
    .logo h1{margin:0;font-family:"Space Grotesk",sans-serif;font-weight:700;font-size:20px;color:#ff6d57}
    .brand-sub{font-size:12px;color:var(--muted);margin-top:2px}

    /* Desktop Navigation */
    .desktop-nav{display:flex; gap:12px; align-items:center;}
    .desktop-nav a{color:#333;text-decoration:none;padding:10px 14px;border-radius:12px;font-weight:600}
    .desktop-nav a.active{background:var(--accent);color:white;box-shadow:0 6px 18px rgba(255,123,101,0.18)}
    .desktop-nav a:hover{background:var(--hover-purple); color:white; transition: background .18s}

    /* Mobile Navigation */
    .mobile-nav-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      padding: 8px;
      border-radius: 8px;
    }
    .mobile-nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    .mobile-nav.active {
      transform: translateX(0);
    }
    .mobile-nav-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: var(--muted);
      padding: 8px;
      border-radius: 8px;
    }
    .mobile-nav-links {
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: center;
    }
    .mobile-nav-links a {
      color: #333;
      text-decoration: none;
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 18px;
      width: 200px;
      text-align: center;
    }
    .mobile-nav-links a.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 6px 18px rgba(255,123,101,0.18);
    }
    .mobile-nav-links a:hover {
      background: var(--hover-purple);
      color: white;
    }

    .btn{
      border:0;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;background:transparent;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary{background:var(--accent);color:white;box-shadow:0 8px 30px rgba(255,123,101,0.18)}
    .btn-ghost{background:var(--accent-2);color:#4a4a58}

    /* content */
    .hero{
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 0 20px;
      position: relative;
      overflow: hidden;
    }
    .hero-content {
      max-width: 900px;
      margin: 0 auto;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 1s ease forwards;
    }
    .hero h2{
      margin:0;font-family:"Space Grotesk",sans-serif;font-weight:700;font-size:clamp(2.5rem, 8vw, 6rem);color:#111;
      line-height:1.02;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .hero .subline{
      font-size:clamp(1rem, 3vw, 1.8rem);
      color:var(--muted);
      margin-top:24px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 1s ease 0.3s forwards;
      line-height: 1.4;
    }
    .hero .actions{
      margin-top:32px;
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap: wrap;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 1s ease 0.6s forwards;
    }
    .hero .stats{
      display:flex;
      gap:20px;
      justify-content:center;
      margin-top:32px;
      flex-wrap: wrap;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 1s ease 0.9s forwards;
    }
    .stat{
      background:var(--card);
      padding:18px 24px;
      border-radius:12px;
      box-shadow:var(--shadow);
      min-width: 120px;
      flex: 1;
      max-width: 180px;
    }
    .stat h3{margin:0;color:var(--accent);font-size:22px}
    .stat p{margin:6px 0 0;color:var(--muted);font-size:14px}

    /* Trending section */
    .trending-section {
      max-width: var(--max-w);
      margin: 80px auto 40px;
      padding: 0 20px;
    }
    .trending-section h3 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: clamp(1.5rem, 4vw, 2rem);
      margin-bottom: 12px;
    }

    /* layout panels */
    .page{
      max-width:var(--max-w);
      margin:26px auto;
      padding:0 20px;
      display:none;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.5s ease forwards;
    }
    .page.active{display:block}

    /* Modal pages */
    .modal-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      z-index: 1000;
      overflow-y: auto;
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .modal-page.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .modal-page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: var(--max-w);
      margin: 0 auto;
      padding: 20px;
    }
    .modal-page-content {
      max-width: var(--max-w);
      margin: 0 auto;
      padding: 0 20px 40px;
    }
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      padding: 8px;
      border-radius: 8px;
    }
    .close-modal:hover {
      background: var(--hover-purple);
      color: white;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:18px;
    }
    @media (max-width:1100px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:720px){ .grid{grid-template-columns:1fr} }

    .card{
      background:var(--card);border-radius:14px;padding:12px;box-shadow:var(--shadow);
      overflow:hidden;display:flex;flex-direction:column;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(20,20,30,0.1);
    }
    .card .img{width:100%;height:170px;background:#eee;border-radius:10px;overflow:hidden}
    .card .img img{width:100%;height:100%;object-fit:cover;display:block}
    .card h4{
      margin:12px 0 4px;
      font-family:'Space Grotesk',sans-serif;
      color:#ff6d57;
      font-size: clamp(14px, 3vw, 16px);
      line-height: 1.3;
    }
    .card p{color:var(--muted);margin:0 0 12px; font-size: 14px;}

    .card .prompt-box{
      background:#fff6ef;
      padding:10px;
      border-radius:10px;
      border:1px solid #f2e0d6;
      color:#4b4b5b;
      font-size: 14px;
      line-height: 1.4;
      word-wrap: break-word;
    }
    .card .actions{display:flex;gap:8px;margin-top:10px}

    /* form panel */
    .panel{
      background:var(--card);padding:18px;border-radius:14px;box-shadow:var(--shadow);
      margin-top:6px;
    }
    input[type="text"], textarea, input[type="file"], select{
      width:100%;padding:10px;border-radius:10px;border:1px solid #eee;background:transparent;font-size:14px;margin-top:8px;
    }
    textarea{min-height:140px;resize:vertical}

    .center{display:flex;justify-content:center}

    /* login modal */
    .modal-backdrop{
      position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(10,10,12,0.4);
      display:none;align-items:center;justify-content:center;z-index:2000;
    }
    .modal{background:var(--card);padding:20px;border-radius:14px;min-width:320px;box-shadow:var(--shadow); max-width: 90vw;}
    .modal.show{display:flex}

    footer{
      max-width:var(--max-w);
      margin:26px auto;
      padding:0 20px;
      color:var(--muted);
      font-size:13px;
      text-align: center;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
    }
    footer a:hover {
      color: var(--hover-purple);
    }

    /* small helpers */
    .muted{color:var(--muted)}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#fff3f1;color:var(--accent);font-weight:700;font-size:12px}

    /* hover purple effect for all buttons/links */
    a:hover, button:hover {
      transition: background .12s, color .12s;
      background: var(--hover-purple) !important;
      color: #fff !important;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .desktop-nav {
        display: none;
      }
      .mobile-nav-toggle {
        display: block;
      }
      .hero .actions {
        flex-direction: column;
        align-items: center;
      }
      .hero .actions .btn {
        width: 100%;
        max-width: 280px;
        justify-content: center;
      }
      .hero .stats {
        gap: 12px;
      }
      .stat {
        min-width: 100px;
        padding: 14px 16px;
      }
      .stat h3 {
        font-size: 18px;
      }
      .modal-page-header h2 {
        font-size: 1.5rem;
      }
      .modal-page-content {
        padding: 0 15px 30px;
      }
    }

    @media (max-width: 480px) {
      .logo h1 {
        font-size: 18px;
      }
      .logo .mark {
        width: 36px;
        height: 36px;
      }
      .hero h2 {
        font-size: clamp(2rem, 10vw, 3rem);
      }
      .hero .subline {
        font-size: 1rem;
      }
      .stat {
        min-width: 80px;
        padding: 12px 10px;
      }
      .stat h3 {
        font-size: 16px;
      }
      .stat p {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>

  <div class="topbar-wrap">
    <header>
      <div class="logo">
        <div class="mark" aria-hidden="true">
          <!-- star svg -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M12 2.5l2.3 4.7 5.2.8-3.8 3.7.9 5.1L12 15.9l-4.6 2.4.9-5.1L4.5 8.0l5.2-.8L12 2.5z"/>
          </svg>
        </div>
        <div>
          <h1>PromptZen</h1>
          <div class="brand-sub">By Code Ronins</div>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav">
        <a id="navHome" class="active" href="#" onclick="navTo('home')">Home</a>
        <a id="navGallery" href="#" onclick="openModalPage('gallery')">Gallery</a>
        <a id="navMy" href="#" onclick="openModalPage('my')">My Prompts</a>
        <a id="navLogin" href="#" onclick="openLogin()">Login</a>
      </nav>

      <!-- Mobile Navigation Toggle -->
      <button class="mobile-nav-toggle" onclick="toggleMobileNav()">☰</button>
    </header>
  </div>

  <!-- Mobile Navigation Menu -->
  <div class="mobile-nav" id="mobileNav">
    <button class="mobile-nav-close" onclick="toggleMobileNav()">×</button>
    <div class="mobile-nav-links">
      <a id="mobileNavHome" class="active" href="#" onclick="navToMobile('home')">Home</a>
      <a id="mobileNavGallery" href="#" onclick="openModalPageMobile('gallery')">Gallery</a>
      <a id="mobileNavMy" href="#" onclick="openModalPageMobile('my')">My Prompts</a>
      <a id="mobileNavLogin" href="#" onclick="openLoginMobile()">Login</a>
    </div>
  </div>

  <!-- HERO (home) -->
  <section class="hero">
    <div class="hero-content">
      <h2><span style="color:#000">Discover & Share</span><br><span style="display:block;margin-top:8px;color:var(--accent);">AI Prompts</span></h2>
      <div class="subline">Discover, submit, and manage creative AI prompts. Join a community of prompt engineers and creators pushing the boundaries of what's possible.</div>

      <div class="actions">
        <button class="btn-primary btn" onclick="openModalPage('my')">
          Submit Your Prompt
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button class="btn btn-ghost" onclick="openModalPage('gallery')">Explore Gallery</button>
      </div>

      <div class="stats">
        <div class="stat">
          <h3 id="statPrompts">0</h3>
          <p>Prompts Shared</p>
        </div>
        <div class="stat">
          <h3 id="statUsers">0</h3>
          <p>Active Users</p>
        </div>
        <div class="stat">
          <h3 id="statCats">12+</h3>
          <p>Categories</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Trending Section -->
  <section class="trending-section">
    <h3>Trending Prompts</h3>
    <div class="muted" style="margin-bottom:12px">Recently submitted prompts from our community</div>
    <div id="trendingGrid" class="grid"></div>
  </section>

  <!-- Modal Pages -->
  <div id="modalGallery" class="modal-page">
    <div class="modal-page-header">
      <h2 style="font-family:'Space Grotesk',sans-serif;margin:0">Gallery</h2>
      <button class="close-modal" onclick="closeModalPage('gallery')">×</button>
    </div>
    <div class="modal-page-content">
      <div class="muted" style="margin-bottom:12px">All community prompts with sample images</div>
      <div id="galleryGrid" class="grid"></div>
    </div>
  </div>

  <div id="modalMy" class="modal-page">
    <div class="modal-page-header">
      <h2 style="font-family:'Space Grotesk',sans-serif;margin:0">My Prompts</h2>
      <button class="close-modal" onclick="closeModalPage('my')">×</button>
    </div>
    <div class="modal-page-content">
      <div style="display:flex;gap:18px;flex-wrap:wrap">
        <div style="flex:1;min-width:320px">
          <div class="panel">
            <h4 style="font-family:'Space Grotesk',sans-serif;margin:0 0 6px">Submit Prompt</h4>
            <div class="muted">Enter prompt text and sample image. Both will be uploaded to server and shown in Gallery after submission.</div>

            <label>Username *</label>
            <input id="fusername" type="text" placeholder="Your name" />

            <label>Prompt Text *</label>
            <textarea id="ftext" placeholder="Describe the prompt (style, mood, lens, color grading, etc.)"></textarea>

            <label>Upload sample image</label>
            <input id="fimage" type="file" accept="image/*" />
            <div id="fpreview" style="margin-top:10px"></div>

            <div style="display:flex;gap:10px;margin-top:12px">
              <button id="submitBtn" class="btn-primary btn">
                Submit
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button id="clearBtn" class="btn btn-ghost">Clear</button>
            </div>
            <div class="muted" style="margin-top:10px">Notes: Images up to 10MB. Allowed: png, jpg, jpeg, webp, gif.</div>
          </div>
        </div>

        <div style="width:380px;min-width:260px">
          <div class="panel">
            <h4 style="margin:0;font-family:'Space Grotesk',sans-serif">My Submitted Prompts</h4>
            <div class="muted" style="margin-top:8px">Prompts you submitted will appear here after submission.</div>
            <div id="myPromptsList" style="margin-top:12px"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- login modal -->
  <div id="modal" class="modal-backdrop">
    <div class="modal">
      <h3 style="margin:0">Login</h3>
      <div style="margin-top:8px">
        <label>Username</label>
        <input id="loginUser" type="text" placeholder="username"/>
        <label style="margin-top:8px">Password</label>
        <input id="loginPass" type="password" placeholder="password"/>
        <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
          <button onclick="closeLogin()" class="btn">Cancel</button>
          <button class="btn-primary btn" onclick="doLogin()">Login</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div style="max-width:var(--max-w);margin:0 auto;padding:0 20px;text-align:center">
      <div>© 2025 PromptZen — by <a href="https://coderonins.vercel.app" target="_blank">Code Ronins</a></div>
      <div>Made with ♥</div>
    </div>
  </footer>

<script>
/* ---------- CONFIG ---------- */
const BACKEND_BASE = ''; // empty means same origin
/* ---------------------------- */

let currentUser = { username:null, role:'user' };

/* ---------- Mobile Navigation ---------- */
function toggleMobileNav() {
  const mobileNav = document.getElementById('mobileNav');
  mobileNav.classList.toggle('active');
  document.body.style.overflow = mobileNav.classList.contains('active') ? 'hidden' : 'auto';
}

function navToMobile(page) {
  navTo(page);
  toggleMobileNav();
}

function openModalPageMobile(page) {
  openModalPage(page);
  toggleMobileNav();
}

function openLoginMobile() {
  openLogin();
  toggleMobileNav();
}

/* ---------- Navigation ---------- */
function navTo(page){
  const pages = ['home','gallery','my'];
  pages.forEach(p=>{
    document.getElementById('page'+capitalize(p)).classList.remove('active');
    document.getElementById('nav'+capitalize(p)).classList.remove('active');
    document.getElementById('mobileNav'+capitalize(p)).classList.remove('active');
  });
  document.getElementById('page'+capitalize(page)).classList.add('active');
  const navId = (page === 'home') ? 'navHome' : (page === 'gallery' ? 'navGallery' : 'navMy');
  document.getElementById(navId).classList.add('active');
  document.getElementById('mobileNav'+capitalize(page)).classList.add('active');

  // If we switched to gallery, ensure it's loaded
  if(page === 'gallery') loadGallery();
  if(page === 'home') loadTrending();
  if(page === 'my') loadMyPrompts();
  
  // Scroll to top when navigating
  window.scrollTo({top: 0, behavior: 'smooth'});
}

function openModalPage(page) {
  document.getElementById('modal' + capitalize(page)).classList.add('active');
  document.body.style.overflow = 'hidden';
  
  if(page === 'gallery') {
    loadGallery();
  } else if(page === 'my') {
    loadMyPrompts();
  }
}

function closeModalPage(page) {
  document.getElementById('modal' + capitalize(page)).classList.remove('active');
  document.body.style.overflow = 'auto';
}

function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

/* ---------- Modal ---------- */
function openLogin(){ document.getElementById('modal').style.display='flex'; }
function closeLogin(){ document.getElementById('modal').style.display='none'; }
async function doLogin(){
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  if(!u || !p) return alert('Please enter username and password');
  
  try {
    const res = await fetch(BACKEND_BASE + '/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: u, password: p })
    });
    
    if(res.ok) {
      const data = await res.json();
      currentUser = { username: data.username, role: data.role };
      localStorage.setItem('promptzen_user', JSON.stringify(currentUser));
      alert('Login successful!');
      closeLogin();
      updateAuthUI();
    } else {
      alert('Login failed. Please check your credentials.');
    }
  } catch(e) {
    console.error(e);
    alert('Login error. Please try again.');
  }
}

/* ---------- Auth UI ---------- */
function updateAuthUI(){
  const navLogin = document.getElementById('navLogin');
  const mobileNavLogin = document.getElementById('mobileNavLogin');
  
  if(currentUser && currentUser.role === 'admin'){
    navLogin.textContent = 'Logout (admin)';
    navLogin.onclick = ()=> { if(confirm('Logout?')) { logout(); } };
    mobileNavLogin.textContent = 'Logout (admin)';
    mobileNavLogin.onclick = ()=> { if(confirm('Logout?')) { logout(); } };
  } else if(currentUser && currentUser.username){
    navLogin.textContent = 'Logout ('+currentUser.username+')';
    navLogin.onclick = ()=> { if(confirm('Logout?')) { logout(); } };
    mobileNavLogin.textContent = 'Logout ('+currentUser.username+')';
    mobileNavLogin.onclick = ()=> { if(confirm('Logout?')) { logout(); } };
  } else {
    navLogin.textContent = 'Login';
    navLogin.onclick = ()=> openLogin();
    mobileNavLogin.textContent = 'Login';
    mobileNavLogin.onclick = ()=> openLoginMobile();
  }
}
function logout(){
  localStorage.removeItem('promptzen_user');
  currentUser = { username:null, role:'user' };
  updateAuthUI();
}

/* ---------- Load stored user ---------- */
(function(){
  const raw = localStorage.getItem('promptzen_user');
  if(raw){
    try{ currentUser = JSON.parse(raw); }catch(e){}
  }
  updateAuthUI();
})();

/* ---------- Fetch prompts from backend ---------- */
async function fetchPrompts(){
  try{
    const res = await fetch(BACKEND_BASE + '/api/prompts');
    if(!res.ok) throw new Error('fetch prompts failed');
    return await res.json();
  }catch(e){
    console.warn('backend fetch failed, returning empty', e);
    return [];
  }
}

/* ---------- Render functions ---------- */
function makeCardHtml(prompt){
  const imgHtml = prompt.image_url ? `<div class="img"><img src="${prompt.image_url}" alt="prompt image"></div>` : `<div class="img" style="display:flex;align-items:center;justify-content:center;color:var(--muted)">No image</div>`;
  const acceptedBadge = prompt.accepted ? `<div class="badge" style="margin-top:8px">Accepted</div>` : '';
  return `<div class="card fade-in">
    ${imgHtml}
    <h4>✦ ${escapeHtml(prompt.text.slice(0,70))}</h4>
    <p class="muted">By ${escapeHtml(prompt.username)} • ${new Date(prompt.created).toLocaleString()}</p>
    <div class="prompt-box">${escapeHtml(prompt.text)}</div>
    <div class="actions">${acceptedBadge}</div>
  </div>`;
}
function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

async function loadGallery(){
  const grid = document.getElementById('galleryGrid');
  grid.innerHTML = '<div class="muted">Loading…</div>';
  const prompts = await fetchPrompts();
  if(prompts.length === 0){ grid.innerHTML = '<div class="muted">No prompts yet.</div>'; return; }
  grid.innerHTML = prompts.map(p=> makeCardHtml(p)).join('');
  updateStats(prompts);
  
  // Trigger fade-in animation for cards
  setTimeout(() => {
    const cards = grid.querySelectorAll('.fade-in');
    cards.forEach(card => {
      card.classList.add('visible');
    });
  }, 100);
}

async function loadTrending(){
  const grid = document.getElementById('trendingGrid');
  grid.innerHTML = '<div class="muted">Loading…</div>';
  const prompts = await fetchPrompts();
  if(prompts.length === 0){ grid.innerHTML = '<div class="muted">No prompts yet. Be the first to submit one!</div>'; updateStats(prompts); return; }
  // show first 6 in trending
  const first = prompts.slice(0,6);
  grid.innerHTML = first.map(p=> makeCardHtml(p)).join('');
  updateStats(prompts);
  
  // Trigger fade-in animation for cards
  setTimeout(() => {
    const cards = grid.querySelectorAll('.fade-in');
    cards.forEach(card => {
      card.classList.add('visible');
    });
  }, 100);
}

/* ---------- My prompts (client) ---------- */
async function loadMyPrompts(){
  const list = document.getElementById('myPromptsList');
  const prompts = await fetchPrompts();
  const me = (currentUser && currentUser.username) ? currentUser.username : null;
  const mine = me ? prompts.filter(p=> p.username === me) : [];
  if(!me) { list.innerHTML = '<div class="muted">Login to see your prompts here.</div>'; return; }
  if(mine.length === 0) list.innerHTML = '<div class="muted">You have no prompts yet.</div>';
  else list.innerHTML = mine.map(p=> `<div style="margin-bottom:10px;padding:8px;border-radius:10px;background:#fff7f2">${escapeHtml(p.text.slice(0,140))} <div class="muted" style="font-size:12px">${new Date(p.created).toLocaleString()}</div></div>`).join('');
}

/* ---------- Update stats ---------- */
function updateStats(prompts){
  document.getElementById('statPrompts').textContent = prompts.length;
  const users = new Set(prompts.map(p=>p.username||'Anonymous'));
  document.getElementById('statUsers').textContent = users.size;
}

/* ---------- Submission handlers ---------- */
document.getElementById('fimage').addEventListener('change', (e)=>{
  const file = e.target.files[0];
  const preview = document.getElementById('fpreview');
  preview.innerHTML = '';
  if(!file) return;
  const url = URL.createObjectURL(file);
  const img = document.createElement('img'); img.src = url; img.style.maxWidth='100%'; img.style.borderRadius='8px';
  preview.appendChild(img);
});

document.getElementById('submitBtn').addEventListener('click', async ()=>{
  const username = document.getElementById('fusername').value.trim();
  const text = document.getElementById('ftext').value.trim();
  const file = document.getElementById('fimage').files[0];
  if(!username || !text) return alert('Please enter username and prompt text');

  const form = new FormData();
  form.append('username', username);
  form.append('text', text);
  if(file) form.append('image', file);

  try{
    const res = await fetch(BACKEND_BASE + '/api/prompts', { method:'POST', body: form });
    if(!res.ok) {
      const j = await res.json().catch(()=>({error:'unknown'}));
      return alert('Upload failed: ' + (j.error || res.status));
    }
    const json = await res.json();
    alert('Submitted! id: ' + json.id);
    // clear
    document.getElementById('ftext').value = '';
    document.getElementById('fimage').value = '';
    document.getElementById('fpreview').innerHTML = '';
    // refresh pages
    loadGallery();
    loadTrending();
    loadMyPrompts();
  }catch(e){
    console.error(e);
    alert('upload error');
  }
});
document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('fusername').value = '';
  document.getElementById('ftext').value = '';
  document.getElementById('fimage').value = '';
  document.getElementById('fpreview').innerHTML = '';
});

/* ---------- init ---------- */
(async function init(){
  await loadTrending();
  // attach nav home active
  navTo('home');
})();
</script>

</body>
</html>
